<%- include('../partials/admin/header') -%>
<body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="index.html" class="brand-wrap">
                <img src="asset/imgs/theme/logo.png" class="logo" alt="GadgetsHub Dashboard">
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i> </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item">
                    <a class="menu-link" href="/admin"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="page-products-list.html"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/productList">Product List</a>
                        <a href="/admin/categoryPage">Categories</a>
                    </div>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Orders</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/order">Order List</a>                        
                    </div>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/addProduct"> <i class="icon material-icons md-add_box"></i>
                        <span class="text">Add product</span>
                    </a>                    
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-local_offer"></i>
                        <span class="text">Coupons</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/couponList">Coupon List</a>
                        <a href="/admin/addCoupon">Add Coupon</a>
                    </div>
                </li>
                <li class="menu-item active">
                    <a class="menu-link" href="/admin/userList"> <i class="icon material-icons md-group"></i>
                        <span class="text">Users</span>
                    </a>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="page-products-list.html"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Offers</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/productOffer">Product Offer</a>
                        <!-- <a href="/admin/categoryOffer">Category Offer</a> -->
                    </div>
                </li>
            </ul>
        </nav>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar">
            <div class="col-search">
            </div>
            <div class="col-nav">
                <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i class="material-icons md-apps"></i> </button>
                <ul class="nav">
                    <li class="dropdown nav-item">
                        <a class="dropdown-item text-danger" href="/admin/logout"><i class="material-icons md-exit_to_app"></i>Logout</a>
                    </li>
                </ul>
            </div>
        </header>


        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">User List</h2>
                    <p></p>
                </div>
                
            </div>
            <div class="card mb-4">
                <header class="card-header">
                    <div class="row align-items-start">
                        <div class="col-md-1 col-check">
                            <div class="form-check">                                
                            </div>
                        </div>
                        <div class="col-md-2 col-12">
                            Name
                        </div>
                        <div class="col-md-2 col-6">
                            Phone Number
                        </div>
                        <div class="col-md-3 col-6">
                            Email
                        </div>
                        <div class="col-md-2 col-6">
                            Date
                        </div>
                        <div class="col-md-2 col-6">
                            Status
                        </div>
                    </div>
                </header> <!-- card-header end// -->
                <%let count=1%>
                <%userData.forEach(function(user){%>
                <div class="card-body">
                    <article class="itemlist">
                        <div class="row align-items-center">
                            
                            <div class="col-md-1 col-check flex-grow-0">
                                <div class="form-check">
                                    <%=count++%>
                                </div>
                            </div>
                            <div class="col-md-2 col-12 flex-grow-1 col-name">
                                <%=user.name%>
                            </div>
                            <div class="col-md-2 col-6 col-price"> <%=user.phone%> </div>
                            <div class="col-md-3 col-6 col-status">
                                <%=user.email%>
                            </div>
                            <div class="col-md-2 col-6 col-date">
                                <span><%= user.createdOn.toLocaleDateString() %></span>
                            </div>
                            <div class="col-md-2 col-6 col-action">
                                <%if(user.isBlocked){%>
                                    <button id="block-button-<%=user._id%>" 
                                        class="btn btn-info rounded font-sm mt-15 block-button" 
                                        data-userid="<%=user._id%>" data-blockstatus="1">Unblock</button>
                                <%}else{%>
                                    <button id="block-button-<%=user._id%>" 
                                        class="btn btn-danger rounded font-sm mt-15 block-button" 
                                        data-userid="<%=user._id%>" data-blockstatus="0">Block</button>
                                    <%}%>
                                
                            </div>
                            
                        </div> <!-- row .// -->
                    </article> <!-- itemlist  .// -->                    
                </div> <!-- card-body end// -->
                <%})%>
            </div> <!-- card end// -->
            <!-- <div class="pagination-area mt-30 mb-50">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-start">
                        <li class="page-item active"><a class="page-link" href="#">01</a></li>
                        <li class="page-item"><a class="page-link" href="#">02</a></li>
                        <li class="page-item"><a class="page-link" href="#">03</a></li>
                        <li class="page-item"><a class="page-link dot" href="#">...</a></li>
                        <li class="page-item"><a class="page-link" href="#">16</a></li>
                        <li class="page-item"><a class="page-link" href="#"><i class="material-icons md-chevron_right"></i></a></li>
                    </ul>
                </nav>
            </div> -->
        </section> <!-- content-main end// -->
        
        <%- include('../partials/admin/footer') -%>



<script>
    $(document).ready(function(){
        $('.block-button').click(function(){
            let button = $(this);
            let userId = button.data('userid');
            let blockStatus = button.data('blockstatus');
            let url = '';
            console.log('hi');
            if(blockStatus) {
                url = '/admin/unblockUser?id=' + userId;
            } else {
                url = '/admin/blockUser?id=' + userId;
            }

            Swal.fire({
                title: 'Are you sure?',
                text: 'This action cannot undone!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result)=>{
                if(result.isConfirmed) {
                    $.ajax({
                        url:url,
                        type: 'GET',
                        success: function(response){
                            if(blockStatus == 1) {
                                button.removeClass('btn-info').addClass('btn-danger').text('Block');
                                button.data('blockstatus', 0);
                            } else {
                                button.removeClass('btn-danger').addClass('btn-info').text('Unblock');
                                button.data('blockstatus', 1);
                            }
                            Swal.fire({
                                title: 'Success',
                                text: 'User has been ' + (blockStatus == 1 ? 'unblocked.' : 'blocked.'),
                                icon: 'success',
                                timer: 2000,
                                showConfirmButton: false
                            });
                        },
                        error: function(error) {
                            console.log('Error: ' + error);
                        }
                    });
                }
            });
        });
    });
</script>