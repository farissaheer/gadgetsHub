<%- include('../partials/admin/header') -%>
<body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="/admin" class="brand-wrap">
                <img src="asset/imgs/theme/logo.png" class="logo" alt="GadgetsHub Dashboard">
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i> </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item active">
                    <a class="menu-link" href="/admin"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/productList">Product List</a>
                        <a href="/admin/categoryPage">Categories</a>
                    </div>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Orders</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/order">Order List</a>                        
                    </div>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/addProduct"> <i class="icon material-icons md-add_box"></i>
                        <span class="text">Add product</span>
                    </a>                    
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-local_offer"></i>
                        <span class="text">Coupons</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/couponList">Coupon List</a>
                        <a href="/admin/addCoupon">Add Coupon</a>
                    </div>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/userList"> <i class="icon material-icons md-group"></i>
                        <span class="text">Users</span>
                    </a>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="page-products-list.html"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Offers</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/productOffer">Product Offer</a>
                        <!-- <a href="/admin/categoryOffer">Category Offer</a> -->
                    </div>
                </li>
            </ul>
        </nav>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar">
            <div class="col-search">
            </div>
            <div class="col-nav">
                <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i class="material-icons md-apps"></i> </button>
                <ul class="nav">
                    <li class="dropdown nav-item">
                        <a class="dropdown-item text-danger" href="/admin/logout"><i class="material-icons md-exit_to_app"></i>Logout</a>
                    </li>
                </ul>
            </div>
        </header>


        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Dashboard </h2>
                    <p>Whole data about your business here</p>
                </div>
                <!-- <div>
                    <a href="#" class="btn btn-primary"><i class="text-muted material-icons md-post_add"></i>Create report</a>
                </div> -->
            </div>
            <div class="row">
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons">&#x20B9;</i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Revenue</h6>
                                <span>₹13,456.5</span>
                                <span class="text-sm">
                                    Shipping fees are not included
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Orders</h6> <span><%=orders.length%></span>
                                <span class="text-sm">
                                    Excluding orders in transit
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-qr_code"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Products</h6> <span><%=productCount%></span>
                                <span class="text-sm">
                                    In 2 Categories
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <!-- <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-shopping_basket"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Monthly Earning</h6> <span>$6,982</span>
                                <span class="text-sm">
                                    Based in your local time.
                                </span>
                            </div>
                        </article>
                    </div>
                </div> -->
            </div>
            <div class="row">
                <div class="col-xl-8 col-lg-12">
                    <div class="card mb-4">
                        <article class="card-body">
                            <h5 class="card-title">Sale statistics</h5>
                            <canvas id="myChart" height="120px"></canvas>
                        </article>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-12">
                    <div class="card mb-4">
                        <article class="card-body">
                            <h5 class="card-title">Sales Base on Monthly</h5>
                            <!-- <h5 class="card-title">Revenue Base on Area</h5> -->
                            <canvas id="myChart2" height="217"></canvas>
                        </article>
                    </div>
                </div>
            </div>
            <!-- <div class="card mb-4">
                <header class="card-header">
                    <h4 class="card-title">Latest orders</h4>
                    <div class="row align-items-center">
                        <div class="col-md-3 col-12 me-auto mb-md-0 mb-3">
                            <div class="custom_select">
                                <select class="form-select select-nice">
                                    <option selected>All Categories</option>
                                    <option>Women's Clothing</option>
                                    <option>Men's Clothing</option>
                                    <option>Cellphones</option>
                                    <option>Computer & Office</option>
                                    <option>Consumer Electronics</option>
                                    <option>Jewelry & Accessories</option>
                                    <option>Home & Garden</option>
                                    <option>Luggage & Bags</option>
                                    <option>Shoes</option>
                                    <option>Mother & Kids</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2 col-6">
                            <input type="date" value="02.05.2021" class="form-control">
                        </div>
                        <div class="col-md-2 col-6">
                            <div class="custom_select">
                                <select class="form-select select-nice">
                                    <option selected>Status</option>
                                    <option>All</option>
                                    <option>Paid</option>
                                    <option>Chargeback</option>
                                    <option>Refund</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </header>
                <div class="card-body">
                    <div class="table-responsive">
                        <div class="table-responsive">
                            <table class="table align-middle table-nowrap mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col" class="text-center">
                                            <div class="form-check align-middle">
                                                <input class="form-check-input" type="checkbox" id="transactionCheck01">
                                                <label class="form-check-label" for="transactionCheck01"></label>
                                            </div>
                                        </th>
                                        <th class="align-middle" scope="col">Order ID</th>
                                        <th class="align-middle" scope="col">Billing Name</th>
                                        <th class="align-middle" scope="col">Date</th>
                                        <th class="align-middle" scope="col">Total</th>
                                        <th class="align-middle" scope="col">Payment Status</th>
                                        <th class="align-middle" scope="col">Payment Method</th>
                                        <th class="align-middle" scope="col">View Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-center">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="transactionCheck02">
                                                <label class="form-check-label" for="transactionCheck02"></label>
                                            </div>
                                        </td>
                                        <td><a href="#" class="fw-bold">#SK2540</a> </td>
                                        <td>Neal Matthews</td>
                                        <td>
                                            07 Oct, 2021
                                        </td>
                                        <td>
                                            $400
                                        </td>
                                        <td>
                                            <span class="badge badge-pill badge-soft-success">Paid</span>
                                        </td>
                                        <td>
                                            <i class="material-icons md-payment font-xxl text-muted mr-5"></i> Mastercard
                                        </td>
                                        <td>
                                            <a href="#" class="btn btn-xs"> View details</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="transactionCheck03">
                                                <label class="form-check-label" for="transactionCheck03"></label>
                                            </div>
                                        </td>
                                        <td><a href="#" class="fw-bold">#SK2541</a> </td>
                                        <td>Jamal Burnett</td>
                                        <td>
                                            07 Oct, 2021
                                        </td>
                                        <td>
                                            $380
                                        </td>
                                        <td>
                                            <span class="badge badge-pill badge-soft-danger">Chargeback</span>
                                        </td>
                                        <td>
                                            <i class="material-icons md-payment font-xxl text-muted mr-5"></i> Visa
                                        </td>
                                        <td>
                                            <a href="#" class="btn btn-xs"> View details</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="transactionCheck04">
                                                <label class="form-check-label" for="transactionCheck04"></label>
                                            </div>
                                        </td>
                                        <td><a href="#" class="fw-bold">#SK2542</a> </td>
                                        <td>Juan Mitchell</td>
                                        <td>
                                            06 Oct, 2021
                                        </td>
                                        <td>
                                            $384
                                        </td>
                                        <td>
                                            <span class="badge badge-pill badge-soft-success">Paid</span>
                                        </td>
                                        <td>
                                            <i class="material-icons md-payment font-xxl text-muted mr-5"></i> Paypal
                                        </td>
                                        <td>
                                            <a href="#" class="btn btn-xs"> View details</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="transactionCheck05">
                                                <label class="form-check-label" for="transactionCheck05"></label>
                                            </div>
                                        </td>
                                        <td><a href="#" class="fw-bold">#SK2543</a> </td>
                                        <td>Barry Dick</td>
                                        <td>
                                            05 Oct, 2021
                                        </td>
                                        <td>
                                            $412
                                        </td>
                                        <td>
                                            <span class="badge badge-pill badge-soft-success">Paid</span>
                                        </td>
                                        <td>
                                            <i class="material-icons md-payment font-xxl text-muted mr-5"></i> Mastercard
                                        </td>
                                        <td>
                                            <a href="#" class="btn btn-xs"> View details</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="transactionCheck06">
                                                <label class="form-check-label" for="transactionCheck06"></label>
                                            </div>
                                        </td>
                                        <td><a href="#" class="fw-bold">#SK2544</a> </td>
                                        <td>Ronald Taylor</td>
                                        <td>
                                            04 Oct, 2021
                                        </td>
                                        <td>
                                            $404
                                        </td>
                                        <td>
                                            <span class="badge badge-pill badge-soft-warning">Refund</span>
                                        </td>
                                        <td>
                                            <i class="material-icons md-payment font-xxl text-muted mr-5"></i> Visa
                                        </td>
                                        <td>
                                            <a href="#" class="btn btn-xs"> View details</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="text-center">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="transactionCheck07">
                                                <label class="form-check-label" for="transactionCheck07"></label>
                                            </div>
                                        </td>
                                        <td><a href="#" class="fw-bold">#SK2545</a> </td>
                                        <td>Jacob Hunter</td>
                                        <td>
                                            04 Oct, 2021
                                        </td>
                                        <td>
                                            $392
                                        </td>
                                        <td>
                                            <span class="badge badge-pill badge-soft-success">Paid</span>
                                        </td>
                                        <td>
                                            <i class="material-icons md-payment font-xxl text-muted mr-5"></i> Paypal
                                        </td>
                                        <td>
                                            <a href="#" class="btn btn-xs"> View details</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div> table-responsive end// 
                </div>
            </div> -->
            <!-- <div class="pagination-area mt-30 mb-50">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-start">
                        <li class="page-item active"><a class="page-link" href="#">01</a></li>
                        <li class="page-item"><a class="page-link" href="#">02</a></li>
                        <li class="page-item"><a class="page-link" href="#">03</a></li>
                        <li class="page-item"><a class="page-link dot" href="#">...</a></li>
                        <li class="page-item"><a class="page-link" href="#">16</a></li>
                        <li class="page-item"><a class="page-link" href="#"><i class="material-icons md-chevron_right"></i></a></li>
                    </ul>
                </nav>
            </div> -->
        </section> <!-- content-main end// -->
        <section class="content-main">
            <main class="main">
                <section class="content-main">
                    <div class="content-header">
                        <div>
                            <h2 class="content-title card-title">Sales Report</h2>
                        </div>
                    </div>
                    <div class="card mb-4">
                        <header class="card-header">
                            <!-- Filter options can be added here if needed -->
                            <div style="padding-left: 30px; padding-right: 30px;">
               
                                <div class="container-fluid p-0">
                                  <div class="row">
                                    <div class="col-md-12 d-flex justify-content-end">
                                      <div class="me-2">
                                      
        
                                        <div class="me-2">
                                            <button type="button" id="btn-print-this" class="btn btn-secondary btn-icon bg-dark">
                                              <i class="bi bi-file-earmark-pdf-fill"></i> PDF
                                            </button>
                                          
                                            <button type="button" onclick="convertTableToExcel()" class="btn btn-secondary btn-icon bg-dark">
                                              <i class="bi bi-file-earmark-excel-fill"></i> Excel
                                            </button>
                                          </div>
                                          
                                      </div>
                                    </div>
                          
                        </header>
        
                        
                             <div class="card-body">
                                <div class="filter-section">
                                    <label for="from-date">From Date:</label>
                                    <input type="date" id="from-date" name="from-date">
                                    
                                    <label for="to-date">To Date:</label>
                                    <input type="date" id="to-date" name="to-date">
                                    
                                    <button id="filter-btn">Filter</button>
                                    <button id="reset-btn">Reset</button>
                                  </div>
                                  
                                <div class="table-responsive">
                                   <table id="order-table" class="table table-hover">
                                       <thead>
                                    <tr>
                                        <th>#ID</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">ProductName</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">MOD</th>
                                        <th scope="col">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% orders.forEach(function(order) { %>
                                        <% order.products.forEach(function(product) { %>
                                            <% if (order.status === "Delivered" || order.status === "Completed")  { %>
                                                <tr>
                                                    <td><%= order._id.toString().substr(-5) %></td>
                                                    <td><b><%= order.userid.name %></b></td>
                                                    <td><%= product.productid.productname %></td>
                                                    <td><%= new Date(order.orderDate).toLocaleDateString() %></td>
                                                    <td><%= order.status %></td>
                                                    <td><%= order.totalAmount %></td>
                                                </tr>
                                            <% } %>
                                        <% }); %>
                                    <% }); %>
                                </tbody>
                                   </table>
        
        
                                </div>
                             </div>
                          </div>
                       </section>
                    </main>
                 </section>


        <script src="asset/js/MyChart.js" type="text/javascript"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>      
        <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>
            $(document).ready(function() {
              $('#btn-print-this').click(function() {
                const tableHTML = $('.table-responsive').html();
                const popupWindow = window.open('', '_blank', 'width=600,height=600');
                popupWindow.document.open();
                popupWindow.document.write(`
                  <html>
                  <head>
                    <title>Print</title>
                    <style>
                      @media print {
                        body * {
                          visibility: hidden;
                        }
                        .table-popup, .table-popup * {
                          visibility: visible;
                        }
                        .table-popup {
                          position: absolute;
                          left: 0;
                          top: 0;
                          width: 100%;
                          height: 100%;
                          overflow: auto;
                        }
                      }
                    </style>
                  </head>
                  <body>
                    <div class="table-popup">
                      ${tableHTML}
                    </div>
                  </body>
                  </html>
                `);
                popupWindow.document.close();
                popupWindow.print();
              });
            });
          </script>
      
      <script>
          $(document).ready(function() {
            // Select the table and the "Total" column cells
            const table = $('#order-table');
            const totalCells = table.find('tbody td:nth-child(6)'); // Assuming "Total" is the 6th column
            
            // Calculate the sum of the "Total" column
            let sum = 0;
            totalCells.each(function() {
              const value = parseFloat($(this).text());
              
              // Add the value to the sum if it is a valid number
              if (!isNaN(value)) {
                sum += value;
              }
            });
            
            // Add the "Total Sales" row to the table
            //   const totalRow = $('<tr>').append('<td colspan="5"><b>Total Sales</b></td><td><b>' + sum + '</b></td>');
              // const totalRow = $('<tr>').append('<td colspan="5"><b><span style="font-size: 16px;">Total Sales</span></b></td><td><b><span style="font-size: 16px;">' + sum + '</span></b></td>');
                  const totalRow = $('<tr>').append('<td colspan="5"><b><span style="font-size: 16px;">Total Sales</span></b></td><td><b><span style="font-size: 16px;">' + sum + '</span></b></td>');

// Find the revenue element and update its content with the sum value
        $('.card-title:contains("Revenue")').next('span').text('₹' + sum);

            table.find('tbody').append(totalRow);
      
      
            
         
            $('#filter-btn').click(function() {
        const fromDate = new Date($('#from-date').val());
        const toDate = new Date($('#to-date').val());
      
        // Hide all rows initially
        table.find('tbody tr').hide();
      
        // Filter rows based on the date range
        table.find('tbody tr').each(function() {
          const dateString = $(this).find('td:nth-child(4)').text(); // Assuming "Date" is the 4th column
          const date = moment(dateString, 'MM/DD/YYYY').toDate();
          console.log(date);
          if (date >= fromDate && date <= toDate) {
            $(this).show();
          }
        });
      });
      
      $('#reset-btn').click(function() {
        // Reset the date inputs and show all rows
        $('#from-date').val('');
        $('#to-date').val('');
        table.find('tbody tr').show();
      });
      
          });
        </script>
        
      
        <!-------------------------- CONVERTING TABLE TO EXCEL---------- -->
      
      <script>
          function convertTableToExcel() {
            // Select the table element
            const table = document.getElementById('order-table');
        
            // Prepare data array
            const data = [];
        
            // Add table headers to the data array
            const headers = [];
            for (let i = 0; i < table.rows[0].cells.length; i++) {
              
              headers.push(table.rows[0].cells[i].textContent);
              
            }
            data.push(headers);
        
            // Iterate through each row of the table (excluding the header row)
            for (let i = 1; i < table.rows.length; i++) {
              const row = table.rows[i];
              const rowData = [];
        
              // Iterate through each cell of the row
              for (let j = 0; j < row.cells.length; j++) {
                rowData.push(row.cells[j].textContent);
                
              }
        
              // Add row data to the data array
              data.push(rowData);
            }
        
            // Create a new workbook
            const workBook = XLSX.utils.book_new();
        
            // Create a new worksheet
            const workSheet = XLSX.utils.aoa_to_sheet(data);
        
            // Add the worksheet to the workbook
            XLSX.utils.book_append_sheet(workBook, workSheet, 'Order Data');
        
            // Convert the workbook to a binary string
            const excelData = XLSX.write(workBook, { bookType: 'xlsx', type: 'binary' });
        
            // Save the binary string as a file
            saveAsExcelFile(excelData, 'orderData.xlsx');
          }
        
          function saveAsExcelFile(data, fileName) {
            const blob = new Blob([s2ab(data)], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            link.click();
            URL.revokeObjectURL(url);
          }
        
          function s2ab(s) {
            const buf = new ArrayBuffer(s.length);
            const view = new Uint8Array(buf);
            for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xff;
            return buf;
          }
        </script>
        <%- include('../partials/admin/footer') -%>
        