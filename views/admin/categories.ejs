<%- include('../partials/admin/header') -%>
<body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="index.html" class="brand-wrap">
                <img src="asset/imgs/theme/logo.png" class="logo" alt="GadgetsHub Dashboard">
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i> </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item">
                    <a class="menu-link" href="/admin"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item active has-submenu">
                    <a class="menu-link" href="page-products-list.html"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/productList">Product List</a>
                        <a href="/admin/categoryPage" class="active">Categories</a>
                    </div>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-shopping_cart"></i>
                        <span class="text">Orders</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/order">Order List</a>                        
                    </div>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/addProduct"> <i class="icon material-icons md-add_box"></i>
                        <span class="text">Add product</span>
                    </a>                    
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="#"> <i class="icon material-icons md-local_offer"></i>
                        <span class="text">Coupons</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/couponList">Coupon List</a>
                        <a href="/admin/addCoupon">Add Coupon</a>
                    </div>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/userList"> <i class="icon material-icons md-group"></i>
                        <span class="text">Users</span>
                    </a>
                </li>
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="page-products-list.html"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Offers</span>
                    </a>
                    <div class="submenu">
                        <a href="/admin/productOffer">Product Offer</a>
                        <!-- <a href="/admin/categoryOffer">Category Offer</a> -->
                    </div>
                </li>
            </ul>
        </nav>
    </aside>
    <main class="main-wrap">
        <header class="main-header navbar">
            <div class="col-search">
            </div>
            <div class="col-nav">
                <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i class="material-icons md-apps"></i> </button>
                <ul class="nav">
                    <li class="dropdown nav-item">
                        <a class="dropdown-item text-danger" href="/admin/logout"><i class="material-icons md-exit_to_app"></i>Logout</a>
                    </li>
                </ul>
            </div>
        </header>

<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Categories </h2>
            <p></p>
        </div>
        <!-- <div>
            <input type="text" placeholder="Search Categories" class="form-control bg-white">
        </div> -->
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <form action="/admin/createCategory" method="POST">
                        <div class="mb-4">
                            <label for="category_name" class="form-label">Name</label>
                            <input type="text" placeholder="Type here" class="form-control" name="categoryName" id="category_name" required/>
                        </div>
                        <!-- <div class="mb-4">
                            <label for="product_slug" class="form-label">Slug</label>
                            <input type="text" placeholder="Type here" class="form-control" id="product_slug" />
                        </div> -->
                        <!-- <%if(locals.categories){%>
                        <div class="mb-4">
                            <label class="form-label">Parent</label>
                            <select class="form-select" name="parent">
                                <option selected value="">Select an option...</option>
                                <%categories.forEach(function(category){%>
                                    <option><%=category.categoryName%></option>
                                <%})%>
                            </select>
                        </div>
                        <%}%> -->
                        <div class="mb-4">
                            <label class="form-label">Description</label>
                            <textarea placeholder="Type here" name="categoryDescription" class="form-control" required></textarea>
                        </div>
                        <div class="d-grid">
                            <button class="btn btn-primary">Create category</button>
                        </div>
                    </form>
                </div>
                <div class="col-md-9">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th class="text-center">
                                        <!-- <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" />
                                        </div> -->
                                    </th>
                                    <th></th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <!-- <th>Slug</th>-->
                                    <th>Status</th> 
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <%let count=0%>
                                <%categories.forEach(function(category){%>
                                <tr>
                                    <td class="text-center">
                                        <!-- <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" />
                                        </div> -->
                                    </td>
                                    <td><%=++count%></td>
                                    <td><b><%=category.categoryName%></b></td>
                                    <td><%=category.categoryDescription%></td>
                                    <!-- <td>/men</td> -->
                                    <td>
                                        <div class="col-md-2 col-6 col-action">
                                            <%if(category.list){%>
                                                <a class="badge rounded-pill alert-success" data-cat_id="<%=category._id%>">Active</a>
                                            <%}else{%>
                                                <a class="badge rounded-pill alert-danger" data-cat_id="<%=category._id%>">Inactive</a>
                                            <%}%>                                            
                                        </div>
                                    </td>
                                    <td>
                                        <div class="col-md-2 col-6 col-action">
                                            <%if(category.list){%>
                                                <a class="badge rounded-pill alert-danger statusButton" data-cat_id="<%=category._id%>">Unlist</a>
                                            <%}else{%>
                                                <a class="badge rounded-pill alert-success statusButton" data-cat_id="<%=category._id%>">List</a>
                                            <%}%>                                            
                                        </div>
                                    </td>
                                </tr>
                                <%})%>                               
                            </tbody>
                        </table>
                    </div>
                </div> <!-- .col// -->
            </div> <!-- .row // -->
        </div> <!-- card body .// -->
    </div> <!-- card .// -->
</section> <!-- content-main end// -->


<%- include('../partials/admin/footer') -%>

<script>
    $('.statusButton').on('click',function(){
        let text=$(this).text().trim();
        let id = $(this).data('cat_id')
        data={ text, id };
        Swal.fire({
            title: "Are you sure?",
            text: "This action can't undone.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes'
        }).then((result)=>{
            if(result.isConfirmed) {
                $.ajax({
                    url: '/admin/categoryListUnlist',
                    method: 'POST',
                    data: data,
                    success: function(response){
                        if(response.message == '1'){
                            Swal.fire({
                                title: 'Success',
                                text: response.status,
                                icon: 'success',
                                confirmButtonText: 'OK'
                            }).then((result)=>{
                                if(result.isConfirmed) {
                                    location.reload();
                                }
                            });
                        } else {
                            Swal.fire({
                                title: 'Error',
                                text: 'Something went wrong',
                                icon: 'error',
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Yes'
                            });
                        }
                    }
                });
            }
        });
    });
</script>
